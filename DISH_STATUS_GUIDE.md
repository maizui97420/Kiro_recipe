# 菜品状态更改指南

## 📋 菜品状态说明

菜品有两种状态：
- **待完成** (`pending`) - 还没有制作的菜品
- **已完成** (`completed`) - 已经制作完成的菜品

## 🎯 更改菜品状态的方法

### 方法1: 点击状态切换按钮（推荐）

在菜品列表中，每个菜品项右侧有操作按钮：

1. **✓ 按钮** - 将"待完成"菜品标记为"已完成"
2. **↻ 按钮** - 将"已完成"菜品标记为"待完成"
3. **🗑️ 按钮** - 删除菜品

**使用步骤：**
1. 在愿望清单页面找到要更改的菜品
2. 点击菜品右侧的 **✓** 或 **↻** 按钮
3. 系统会自动更新状态并显示成功提示

### 方法2: 长按菜品项

对于自己添加的菜品，可以长按菜品项调出操作菜单：

1. **长按菜品项** 2-3秒
2. 会弹出操作菜单，包含：
   - "标记为已完成" / "标记为未完成"
   - "删除菜品"
3. 选择相应的操作即可

## 🔐 权限说明

### 可以管理的菜品
- ✅ **自己添加的菜品** - 可以更改状态和删除
- ❌ **他人添加的菜品** - 只能查看，不能修改

### 权限检查
系统会自动检查权限：
- 如果尝试修改他人的菜品，会提示"只能管理自己添加的菜品"
- 只有菜品的添加者才能看到操作按钮

## 🎨 界面标识

### 状态标签
每个菜品都有状态标签：
- **绿色"已完成"标签** - 表示菜品已制作完成
- **橙色"待完成"标签** - 表示菜品还未制作

### 操作按钮
- **✓ 按钮** - 绿色，用于标记完成
- **↻ 按钮** - 蓝色，用于标记未完成  
- **🗑️ 按钮** - 红色，用于删除菜品

## 🔄 实时同步

状态更改会实时同步到所有群组成员：
- 更改状态后，其他成员会立即看到变化
- 使用了数据库实时监听技术
- 无需手动刷新页面

## 📱 操作流程示例

### 示例1: 标记菜品为已完成
1. 在愿望清单中找到"红烧肉"（状态：待完成）
2. 点击右侧的 **✓** 按钮
3. 系统提示："红烧肉" 已完成！
4. 菜品状态变为"已完成"，标签变为绿色

### 示例2: 重新标记为未完成
1. 找到已完成的"红烧肉"
2. 点击右侧的 **↻** 按钮
3. 系统提示："红烧肉" 标记为未完成
4. 菜品状态变为"待完成"，标签变为橙色

### 示例3: 删除菜品
1. 长按要删除的菜品项
2. 在弹出菜单中选择"删除菜品"
3. 确认删除操作
4. 菜品从列表中移除

## 🛠️ 技术实现

### 云函数调用
状态更改通过调用 `dish` 云函数实现：

```javascript
wx.cloud.callFunction({
  name: 'dish',
  data: {
    action: 'updateStatus',
    dishId: 'dish_id',
    status: 'completed' // 或 'pending'
  }
})
```

### 实时数据监听
使用微信云数据库的实时监听功能：
- 监听菜品集合的变化
- 自动更新界面显示
- 多端同步状态变更

### 权限验证
- 前端检查：组件中验证用户权限
- 后端验证：云函数中再次验证权限
- 双重保障确保数据安全

## 🎯 用户体验优化

### 视觉反馈
- **触觉反馈** - 操作时有轻微震动
- **动画效果** - 状态切换有平滑动画
- **颜色变化** - 不同状态有不同颜色标识

### 操作提示
- **成功提示** - 操作成功时显示确认消息
- **错误提示** - 操作失败时显示错误原因
- **权限提示** - 无权限时给出明确说明

### 性能优化
- **批量操作** - 支持快速连续操作
- **缓存机制** - 减少重复网络请求
- **懒加载** - 大列表时按需加载

## 🔍 常见问题

### Q: 为什么看不到操作按钮？
A: 只有菜品的添加者才能看到操作按钮。如果是他人添加的菜品，你只能查看不能修改。

### Q: 点击按钮没有反应怎么办？
A: 检查网络连接，确保云函数正常部署。可以尝试刷新页面或重新进入。

### Q: 状态更改后其他人看不到怎么办？
A: 实时监听可能有延迟，通常几秒内会同步。如果长时间不同步，可以手动刷新页面。

### Q: 可以批量更改状态吗？
A: 目前只支持单个菜品操作。批量操作功能可以在后续版本中添加。

## 📈 统计功能

系统会自动统计：
- **总菜品数量** - 群组中的所有菜品
- **已完成数量** - 已制作的菜品数量
- **完成率** - 已完成菜品的百分比
- **个人贡献** - 每个成员添加和完成的菜品数量

这些统计数据可以帮助了解群组的活跃度和菜品制作进度。